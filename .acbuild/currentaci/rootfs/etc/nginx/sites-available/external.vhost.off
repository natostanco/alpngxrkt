upstream hhvm-ex {
   ip_hash;
   server 190.102.111.104:9000;
 #  server unix:/var/run/hhvm/hhvm.sock;
}
server {
listen 199.188.72.109:80;
listen [2605:f700:c0:1::57ec:7a69]:80 ipv6only=on;
#listen 199.188.72.109:443 deferred ssl spdy;
server_name unto.re *.unto.re;
root   /var/www/ex;
include conf.d/files.nix;
include snippets/blg_rewrites.nix;
#pagespeed
include common/pagespeed.conf;
include snippets/pagespeed.conf;
pagespeed CacheFragment blogmal;
pagespeed RespectXForwardedProto on;
pagespeed Domain blogmal.com,*.blogmal.com,vpsgratis.com,*.googleapis.com,google.com,*.google.com,*.zemanta.com,rawgit.com,pagead2.googlesyndication.com,cdn.georiot.com,*;
pagespeed MapRewriteDomain https://blogmal.com https://*.blogmal.com;
# php files
location ~ \.(hh|php)$ {
#fastcgi_pass unix:/var/run/hhvm/hhvm.sock;
fastcgi_pass hhvm-ex;
include conf.d/php-server.nix;
}
location @fallback {
fastcgi_pass    unix:/var/run/php/php7.0-fpm.sock;
include conf.d/php-server.nix;
}
# permalinks
location / {
add_header 'Access-Control-Allow-Origin' '*';
add_header 'Access-Control-Allow-Credentials' 'true';
add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
add_header 'Access-Control-Allow-Headers' 'DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';
try_files $uri $uri/ /index.php?$args;
rewrite logout\/(.*) /wp-login.php?action=logout&_wpnonce=$1 last;
}
# yaourl config
location /hurls/ {
try_files $uri $uri/ /hurls/yourls-loader.php;
}
# security
include conf.d/bm_betterWpSecurity.nix;
location ~ /\. {
deny all;
access_log off;
log_not_found off;
}
location = /favicon.ico {
log_not_found off;
access_log off;
}
location = /robots.txt {
allow all;
log_not_found off;
access_log off;
}
index index.html index.htm index.php index.cgi index.pl index.xhtml;
# errors
error_page 400 /error/400.html;
error_page 401 /error/401.html;
error_page 403 /error/403.html;
error_page 404 /error/404.html;
error_page 405 /error/405.html;
error_page 500 /error/500.html;
error_page 502 /error/502.html;
error_page 503 /error/503.html;
recursive_error_pages off;
location = /error/400.html {
internal;
}
location = /error/401.html {
internal;
}
location = /error/403.html {
internal;
}
location = /error/404.html {
internal;
}
location = /error/405.html {
internal;
}
location = /error/500.html {
internal;
}
location = /error/502.html {
internal;
}
location = /error/503.html {
internal;
}
error_log /var/log/blogmal.error.log;
access_log /var/log/blogmal.access.log combined;
}
